#!/usr/bin/env bash
#SBATCH --job-name=CheckFileType
#SBATCH --partition=nodes
#SBATCH --time=0-00:05:00
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=1
#SBATCH --mem=1G
#SBATCH --account=pet-hadron-2019
#SBATCH --output=%x-%j.log
#SBATCH --error=%x-%j.err

module load ROOT/6.30.06-foss-2023a

TEST_FILE="/users/bp969/scratch/VIKING_FOLDER/SIMULATION_RESULTS/TEST_T1-250_T2-260_T3-330_T4-340_P1-215_P2-230_F1-290_F2-300_E1-400/TEST_T1-250_T2-260_T3-330_T4-340_P1-215_P2-230_F1-290_F2-300_E1-400_1.root"

echo "=== ANALYZING FILE TYPE ==="
echo "File: $TEST_FILE"

root -l -b -q << EOF
TFile *f = TFile::Open("$TEST_FILE");
if(f && !f->IsZombie()) {
  cout << "\nFile contents:" << endl;
  f->ls();
  
  TTree *ntuple1 = (TTree*)f->Get("Ntuple1");
  TTree *ntuple2 = (TTree*)f->Get("Ntuple2");  
  TTree *ntuple3 = (TTree*)f->Get("Ntuple3");
  TTree *kaonEventInfo = (TTree*)f->Get("kaonEventInfo");
  TTree *kaonVectors = (TTree*)f->Get("kaonVectors");
  
  cout << "\n=== FILE TYPE ANALYSIS ===" << endl;
  
  if(ntuple1 || ntuple2 || ntuple3) {
    cout << "✓ This contains RAW SIMULATION DATA:" << endl;
    if(ntuple1) cout << "  - Ntuple1 (kaon decay info): " << ntuple1->GetEntries() << " entries" << endl;
    if(ntuple2) cout << "  - Ntuple2 (decay products): " << ntuple2->GetEntries() << " entries" << endl;
    if(ntuple3) cout << "  - Ntuple3 (detector hits): " << ntuple3->GetEntries() << " entries" << endl;
  }
  
  if(kaonEventInfo || kaonVectors) {
    cout << "✓ This contains PARSED DATA:" << endl;
    if(kaonEventInfo) cout << "  - kaonEventInfo (acceptance): " << kaonEventInfo->GetEntries() << " entries" << endl;
    if(kaonVectors) cout << "  - kaonVectors (momentum vectors): " << kaonVectors->GetEntries() << " entries" << endl;
  }
  
  if((ntuple1 || ntuple2 || ntuple3) && !(kaonEventInfo || kaonVectors)) {
    cout << "\n>>> CONCLUSION: This is ONLY raw simulation data" << endl;
    cout << ">>> The parsing macros did NOT complete successfully" << endl;
    cout << ">>> Your pipeline will produce empty histograms because parsing timed out" << endl;
  } else if(kaonEventInfo || kaonVectors) {
    cout << "\n>>> CONCLUSION: This contains parsed data" << endl;
    cout << ">>> The parsing macros completed successfully" << endl;
    cout << ">>> Your pipeline should produce populated histograms" << endl;
  }
  
  f->Close();
} else {
  cout << "ERROR: Could not open file!" << endl;
}
EOF